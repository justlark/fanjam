name = "sparklefish-server"
main = "build/worker/shim.mjs"
account_id = "151bc8670b862fa7d694cf7246a2c0dc"
compatibility_date = "2025-05-06"

[build]
command = "cargo install -q worker-build && worker-build --release"

[observability]
enabled = true

[env.test]

[env.test.vars]
BASE_DOMAIN = "fanjam.live"
CLIENT_DOMAIN = "test.fanjam.live"
# We can disable caching for test environments; the load will always be small,
# and it's more convenient to not have to wait for the cache to expire. If you
# need to test the caching functionality, you can always change this
# temporarily and redeploy.
NOCO_CACHE_TTL_SECONDS = "0"

[env.test.route]
pattern = "api-test.fanjam.live"
custom_domain = true

[[env.test.kv_namespaces]]
binding = "KV"
id = "0afa0089d1f14e0c907f68b5dba8db90"
preview_id = "0afa0089d1f14e0c907f68b5dba8db90"

[env.prod]

[env.prod.vars]
BASE_DOMAIN = "fanjam.live"
CLIENT_DOMAIN = "fanjam.live"
# This should be small enough that users don't notice, but large enough to
# reduce the load on the origin server.
NOCO_CACHE_TTL_SECONDS = "10"

[env.prod.route]
pattern = "api.fanjam.live"
custom_domain = true

[[env.prod.kv_namespaces]]
binding = "KV"
id = "c36821103a5045fc9de6baad28623928"
preview_id = "0afa0089d1f14e0c907f68b5dba8db90"
